<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analisis Potensi Diri (Akurasi Tinggi)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <!-- Libraries for PDF and DOCX export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <script src="https://unpkg.com/html-to-docx@1.8.0/dist/html-to-docx.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card {
            background-color: white;
            border-radius: 1rem;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .btn-answer {
            transition: all 0.2s ease-in-out;
            border: 2px solid #e5e7eb;
        }
        .btn-answer:hover {
            transform: translateY(-2px);
            border-color: #6d28d9;
            background-color: #f5f3ff;
        }
        /* Styles for the report content */
        .report-section h3 { font-size: 1.25rem; font-weight: 700; color: #1f2937; margin-bottom: 0.5rem; }
        .report-section h4 { font-size: 1.1rem; font-weight: 600; color: #4b5563; margin-top: 1rem; }
        .report-section p, .report-section li { color: #4b5563; }
        .report-section ul { list-style-type: disc; padding-left: 1.5rem; margin-top: 0.5rem; }
        .tab-btn { padding: 0.75rem 1rem; border-bottom: 3px solid transparent; transition: all 0.2s; }
        .tab-btn.active { border-color: #6d28d9; color: #6d28d9; font-weight: 600; }
    </style>
</head>
<body class="gradient-bg min-h-screen flex items-center justify-center p-4">

    <div id="app-container" class="w-full max-w-4xl mx-auto">
        
        <!-- Start Screen -->
        <div id="start-screen" class="card p-8 text-center">
            <h1 class="text-3xl md:text-4xl font-bold text-gray-800 mb-2">Analisis Potensi Diri</h1>
            <p class="text-gray-600 mb-6">Tes ini dirancang untuk memberikan hasil yang lebih akurat dengan pertanyaan berbasis skenario. Jawablah sesuai reaksi pertamamu, bukan jawaban yang menurutmu 'ideal'. Kejujuran adalah kunci.</p>
            <button onclick="showUserForm()" class="w-full bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-purple-800 transition-colors">
                Mulai Analisis Mendalam
            </button>
        </div>

        <!-- User Form Screen -->
        <div id="user-form-screen" class="card p-8 hidden">
            <h2 class="text-2xl font-bold text-center text-gray-800 mb-4">Langkah Terakhir Sebelum Memulai</h2>
            <p class="text-center text-gray-600 mb-6">Isi data Anda untuk melanjutkan ke tes. Laporan hasil analisis akan dikirimkan juga ke email Anda.</p>
            <form id="user-form" onsubmit="startQuiz(event)">
                <div class="space-y-4">
                    <div>
                        <label for="userName" class="block text-sm font-medium text-gray-700">Nama Lengkap</label>
                        <input type="text" id="userName" name="userName" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    <div>
                        <label for="userEmail" class="block text-sm font-medium text-gray-700">Alamat Email</label>
                        <input type="email" id="userEmail" name="userEmail" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                    </div>
                    <div>
                        <label for="userPhone" class="block text-sm font-medium text-gray-700">Nomor HP (WhatsApp)</label>
                        <input type="tel" id="userPhone" name="userPhone" required class="mt-1 block w-full px-3 py-2 bg-white border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-purple-500 focus:border-purple-500">
                    </div>
                </div>
                <button type="submit" class="w-full mt-6 bg-purple-700 text-white font-bold py-3 px-8 rounded-lg text-lg hover:bg-purple-800 transition-colors">
                    Lanjutkan ke Tes
                </button>
            </form>
        </div>

        <!-- Quiz Screen -->
        <div id="quiz-screen" class="card p-8 hidden">
            <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
                <div id="progress-bar" class="bg-purple-600 h-2.5 rounded-full" style="width: 0%"></div>
            </div>
            <p id="question-counter" class="text-center text-sm text-gray-500 mb-4"></p>
            <h2 id="question-text" class="text-xl font-semibold text-gray-800 mb-6 text-center"></h2>
            <div id="answers-container" class="space-y-4"></div>
            <div class="mt-6 pt-4 border-t border-gray-200">
                <button id="back-btn" onclick="goBack()" class="w-full bg-gray-200 text-gray-700 font-bold py-2 px-4 rounded-lg hover:bg-gray-300 disabled:opacity-50 disabled:cursor-not-allowed">
                    Kembali
                </button>
            </div>
        </div>

        <!-- Result Screen -->
        <div id="result-screen" class="card p-8 hidden">
            <div id="report-content-for-download">
                <div class="text-center">
                    <h1 class="text-3xl font-bold mb-2">Dasbor Potensi Komprehensif</h1>
                    <h2 id="dominant-title" class="text-2xl font-bold text-purple-700 mb-8"></h2>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-5 gap-6 items-center mb-8">
                    <div id="summary-text" class="md:col-span-3"></div>
                    <div class="md:col-span-2"><canvas id="resultChart"></canvas></div>
                </div>
                <div class="border-b border-gray-300">
                    <nav id="tabs-container" class="flex -mb-px" aria-label="Tabs"></nav>
                </div>
                <div id="tab-content" class="mt-6"></div>
            </div>
            
            <div class="mt-8 pt-6 border-t-2 border-dashed">
                <h3 class="text-xl font-bold text-center text-gray-800 mb-4">Simpan Laporan Anda</h3>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="downloadPDF()" class="flex-1 bg-red-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-red-700 transition-colors">Download PDF</button>
                    <button onclick="downloadDOCX()" class="flex-1 bg-blue-600 text-white font-bold py-3 px-6 rounded-lg hover:bg-blue-700 transition-colors">Download DOCX</button>
                </div>
            </div>
            <div class="text-center mt-8"><button onclick="restartQuiz()" class="text-gray-500 hover:text-gray-700 font-semibold">Ulangi Analisis</button></div>
        </div>
    </div>

    <script>
        // --- DATA & PROFILES (DIPERSINGKAT UNTUK KETERBACAAN) ---
        const questions = [
            { q: "Saat dihadapkan pada tugas baru yang rumit, apa yang Anda lakukan pertama kali?", a: [ { text: "Mencari tahu 'mengapa' tugas ini penting dan apa tujuan besarnya.", type: "kreatif" }, { text: "Memecahnya menjadi langkah-langkah kecil yang bisa langsung dikerjakan.", type: "logis" } ]},
            { q: "Seorang teman curhat tentang masalah pribadinya. Reaksi alami Anda adalah...", a: [ { text: "Mencoba merasakan apa yang ia rasakan dan memberikan dukungan emosional.", type: "perasa" }, { text: "Langsung menawarkan beberapa solusi praktis yang bisa ia coba.", type: "serbabisa" } ]},
            { q: "Anda lebih memilih lingkungan kerja yang...", a: [ { text: "Memiliki prosedur dan aturan yang jelas untuk diikuti.", type: "praktis" }, { text: "Memberi kebebasan untuk bereksperimen dan mencoba cara baru.", type: "kreatif" } ]},
            { q: "Dalam sebuah argumen, Anda cenderung...", a: [ { text: "Fokus pada data dan fakta untuk menemukan siapa yang benar secara objektif.", type: "logis" }, { text: "Mencari jalan tengah agar keharmonisan hubungan tetap terjaga.", type: "perasa" } ]},
            { q: "Melihat sebuah barang unik di toko, pikiran pertama Anda adalah...", a: [ { text: "'Bagaimana cara kerjanya dan terbuat dari apa benda ini?'", type: "logis" }, { text: "'Benda ini mengingatkanku pada kenangan masa kecil.'", type: "praktis" } ]},
            { q: "Jika Anda harus belajar skill baru, cara ternyaman bagi Anda adalah...", a: [ { text: "Langsung praktik, trial and error, dan merasakan sendiri prosesnya.", type: "serbabisa" }, { text: "Membaca teorinya terlebih dahulu sampai paham betul konsepnya.", type: "kreatif" } ]},
            { q: "Anda diminta memimpin proyek. Prioritas utama Anda adalah...", a: [ { text: "Memastikan semua anggota tim merasa nyaman dan bisa bekerja sama dengan baik.", type: "perasa" }, { text: "Memastikan semua tugas selesai tepat waktu sesuai jadwal dan target.", type: "logis" } ]},
            { q: "Mana yang lebih menggambarkan diri Anda?", a: [ { text: "Saya adalah orang yang konsisten dan bisa diandalkan untuk hal-hal rutin.", type: "praktis" }, { text: "Saya adalah orang yang fleksibel dan mudah beradaptasi dengan perubahan.", type: "serbabisa" } ]},
            { q: "Saat merencanakan liburan, Anda lebih suka...", a: [ { text: "Membuat jadwal yang detail dari hari ke hari.", type: "logis" }, { text: "Menentukan tujuan utamanya saja, sisanya mengalir spontan.", type: "kreatif" } ]},
            { q: "Anda merasa paling berenergi saat...", a: [ { text: "Menghabiskan waktu berkualitas dengan orang-orang terdekat.", type: "perasa" }, { text: "Menyelesaikan sebuah tugas sulit sendirian dengan fokus penuh.", type: "praktis" } ]},
            { q: "Jika ada dua pekerjaan: satu bergaji tinggi tapi membosankan, satu lagi gajinya lebih rendah tapi sangat menantang secara kreatif. Anda cenderung memilih...", a: [ { text: "Pekerjaan yang menantang secara kreatif.", type: "kreatif" }, { text: "Pekerjaan yang bergaji tinggi.", type: "praktis" } ]},
            { q: "Ketika sistem yang ada tidak efisien, Anda akan...", a: [ { text: "Menganalisis sistem itu, mencari kelemahannya, dan merancang sistem baru yang lebih baik.", type: "logis" }, { text: "Mencari cara cepat untuk mengakali sistem itu agar pekerjaan tetap selesai.", type: "serbabisa" } ]},
            { q: "Anda lebih mudah mengingat...", a: [ { text: "Wajah dan ekspresi seseorang.", type: "perasa" }, { text: "Nama dan detail spesifik yang mereka sebutkan.", type: "praktis" } ]},
            { q: "Sebuah ide baru muncul di kepala Anda. Langkah selanjutnya adalah...", a: [ { text: "Segera menceritakannya ke orang lain untuk melihat reaksi mereka.", type: "perasa" }, { text: "Menyimpannya dulu, memikirkannya matang-matang, baru dieksekusi.", type: "kreatif" } ]},
            { q: "Anda paling tidak suka jika...", a: [ { text: "Diberi tugas tanpa instruksi yang jelas.", type: "praktis" }, { text: "Diberi tugas yang terlalu banyak aturan dan batasan.", type: "kreatif" } ]}
        ];
        const profiles = {
            praktis: { title: "Si Praktis (Tipe Pelaksana)", color: "#ef4444", emoji: "🛠️", report: { wirausaha: { title: "Jalur Wirausaha", peran: "Anda adalah tipe pendiri yang berpegang pada kenyataan...", kunci: ["Eksekusi yang Andal", "Manajemen Inventaris", "Konsistensi Kualitas"], tantangan: ["Kaku Terhadap Perubahan", "Kurang Inovatif"] }, profesional: { title: "Jalur Profesional", peran: "Anda adalah tulang punggung perusahaan...", kunci: ["Spesialis di satu bidang", "Manajemen proyek rapi", "Kepatuhan standar"], tantangan: ["Terlihat Kurang Menonjol", "Sulit Beradaptasi"] }, pendidik: { title: "Jalur Pendidik", peran: "Anda adalah tipe instruktur atau pelatih vokasi...", kunci: ["Mengajar berbasis praktik", "Sabar membimbing", "Modul pelatihan jelas"], tantangan: ["Kurang Fleksibel", "Bosan dengan Teori"] }, kreator: { title: "Jalur Kreator & Sosial", peran: "Anda adalah kreator konten 'how-to' atau DIY...", kunci: ["Konten tutorial detail", "Review produk jangka panjang", "Membangun komunitas hobi"], tantangan: ["Konten Monoton", "Kurang dalam Storytelling"] } } },
            logis: { title: "Si Logis (Tipe Analis)", color: "#3b82f6", emoji: "🏛️", report: { wirausaha: { title: "Jalur Wirausaha", peran: "Anda adalah Sang Arsitek Bisnis...", kunci: ["Membangun Sistem dari Nol", "Inovasi Berbasis Data", "Problem Solving Kompleks"], tantangan: ["Analysis Paralysis", "Mengabaikan Aspek Manusia"] }, profesional: { title: "Jalur Profesional", peran: "Anda adalah pemecah masalah dan ahli strategi...", kunci: ["Analisis Data", "Manajemen Proyek Kompleks", "Pengembangan Sistem"], tantangan: ["Dianggap Kaku", "Frustrasi dengan Birokrasi"] }, pendidik: { title: "Jalur Pendidik", peran: "Anda adalah dosen atau pembuat kurikulum brilian...", kunci: ["Mengajar bidang eksak (STEM)", "Metode pengajaran berbasis logika", "Riset akademis"], tantangan: ["Terlalu Teoritis", "Kurang Sabar"] }, kreator: { title: "Jalur Kreator & Sosial", peran: "Anda adalah kreator konten 'explainer'...", kunci: ["Konten analisis", "Infografis berbasis data", "Menulis buku non-fiksi"], tantangan: ["Konten Terasa 'Kering'", "Perfeksionis"] } } },
            kreatif: { title: "Si Kreatif (Tipe Visioner)", color: "#10b981", emoji: "💡", report: { wirausaha: { title: "Jalur Wirausaha", peran: "Anda adalah Sang Visioner...", kunci: ["Menemukan Peluang di 'Blue Ocean'", "Branding & Storytelling", "Pivot & Adaptasi Cepat"], tantangan: ["Bosan dengan Detail", "Ide yang Tidak Realistis"] }, profesional: { title: "Jalur Profesional", peran: "Anda adalah sumber inovasi di perusahaan...", kunci: ["Pengembangan Produk Baru", "Strategi Pemasaran Kreatif", "Problem Solving dengan Cara Baru"], tantangan: ["Dianggap 'Tukang Mimpi'", "Tidak Suka Aturan"] }, pendidik: { title: "Jalur Pendidik", peran: "Anda adalah guru yang inspiratif...", kunci: ["Mengajar berbasis proyek", "Mendorong pemikiran kritis", "Menjadi mentor"], tantangan: ["Bosan dengan Kurikulum Baku", "Sulit Menilai Secara Objektif"] }, kreator: { title: "Jalur Kreator & Sosial", peran: "Anda adalah seorang 'thought leader' atau influencer...", kunci: ["Membangun personal brand kuat", "Konten yang memprovokasi pemikiran", "Storytelling lintas platform"], tantangan: ["Inkonsisten", "Burnout"] } } },
            perasa: { title: "Si Perasa (Tipe Penghubung)", color: "#f97316", emoji: "❤️", report: { wirausaha: { title: "Jalur Wirausaha", peran: "Anda adalah Pembangun Komunitas...", kunci: ["Membangun Komunitas Loyal", "Layanan Pelanggan Luar Biasa", "Kultur Perusahaan Positif"], tantangan: ["Sulit Mengambil Keputusan Tegas", "Mengabaikan Profitabilitas"] }, profesional: { title: "Jalur Profesional", peran: "Anda adalah 'lem' perekat tim...", kunci: ["Manajemen Hubungan Klien", "Pengembangan Tim & Resolusi Konflik", "Negosiasi & Diplomasi"], tantangan: ["Terlalu Terbawa Perasaan", "Dicurhati Terus-menerus"] }, pendidik: { title: "Jalur Pendidik", peran: "Anda adalah guru atau konselor yang disukai...", kunci: ["Menjadi wali kelas/konselor", "Mengajar ilmu sosial", "Lingkungan belajar positif"], tantangan: ["Sulit Memberi Nilai Jelek", "Energi Terkuras oleh Emosi Siswa"] }, kreator: { title: "Jalur Kreator & Sosial", peran: "Anda adalah influencer yang membangun hubungan erat...", kunci: ["Membangun komunitas solid", "Konten cerita personal", "Kolaborasi"], tantangan: ["Haters & Kritik Pedas", "Over-sharing"] } } },
            serbabisa: { title: "Si Serba Bisa (Tipe Penolong)", color: "#8b5cf6", emoji: "⚡", report: { wirausaha: { title: "Jalur Wirausaha", peran: "Anda adalah Sang Pemadam Kebakaran...", kunci: ["Adaptasi Cepat", "Multitasking & Manajemen Krisis", "Menemukan 'Jalan Pintas'"], tantangan: ["Kurang Fokus Jangka Panjang", "Reaktif, Bukan Proaktif"] }, profesional: { title: "Jalur Profesional", peran: "Anda adalah seorang generalis yang berharga...", kunci: ["Manajemen Proyek Fleksibel (Agile)", "Sales & Business Development", "Customer Support"], tantangan: ["Sulit Mendapatkan Promosi Spesialis", "Merasa Bosan dengan Rutinitas"] }, pendidik: { title: "Jalur Pendidik", peran: "Anda adalah guru pengganti atau guru ekstrakurikuler favorit...", kunci: ["Menjadi pelatih di berbagai bidang", "Mengajar 'learning by doing'", "Mengelola acara sekolah"], tantangan: ["Kurang Mendalam dalam Satu Topik", "Persiapan Kurang Terstruktur"] }, kreator: { title: "Jalur Kreator & Sosial", peran: "Anda adalah kreator konten 'Jack of all trades'...", kunci: ["Konten yang variatif", "Cepat mengikuti tren viral", "Personal brand 'teman yang seru'"], tantangan: ["Audiens Bingung dengan Niche", "Kualitas Konten Naik-Turun"] } } }
        };

        // --- STATE MANAGEMENT ---
        let currentQuestionIndex = 0;
        let scores = { praktis: 0, logis: 0, kreatif: 0, perasa: 0, serbabisa: 0 };
        let answerHistory = [];
        let myChart;
        let userProfile = {};
        let userData = {};

        // --- GOOGLE SCRIPT URL ---
        const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbzCsVkQm0FuK8l52Fg0qFf1MlVd1bgwPHwBhlGMcsUua4sgVsW4W47sHnoGCQO0Flw-Yw/exec";

        // --- CORE FUNCTIONS ---
        function showUserForm() {
            document.getElementById('start-screen').classList.add('hidden');
            document.getElementById('user-form-screen').classList.remove('hidden');
        }

        function startQuiz(event) {
            event.preventDefault();
            userData.name = document.getElementById('userName').value;
            userData.email = document.getElementById('userEmail').value;
            userData.phone = document.getElementById('userPhone').value;

            document.getElementById('user-form-screen').classList.add('hidden');
            document.getElementById('quiz-screen').classList.remove('hidden');
            answerHistory = [];
            displayQuestion();
        }

        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('question-text').textContent = question.q;
            const answersContainer = document.getElementById('answers-container');
            answersContainer.innerHTML = '';
            question.a.forEach(answer => {
                const button = document.createElement('button');
                button.className = 'w-full p-4 text-left rounded-lg btn-answer';
                button.textContent = answer.text;
                button.onclick = () => selectAnswer(answer.type);
                answersContainer.appendChild(button);
            });
            updateProgress();
            document.getElementById('back-btn').disabled = currentQuestionIndex === 0;
        }
        
        function selectAnswer(type) {
            scores[type]++;
            answerHistory[currentQuestionIndex] = type;
            currentQuestionIndex++;
            if (currentQuestionIndex < questions.length) {
                displayQuestion();
            } else {
                showResults();
            }
        }

        function goBack() {
            if (currentQuestionIndex > 0) {
                currentQuestionIndex--;
                const lastAnswerType = answerHistory[currentQuestionIndex];
                if (lastAnswerType) {
                    scores[lastAnswerType]--;
                }
                displayQuestion();
            }
        }

        function updateProgress() {
            const progress = ((currentQuestionIndex + 1) / questions.length) * 100;
            document.getElementById('progress-bar').style.width = `${progress}%`;
            document.getElementById('question-counter').textContent = `Pertanyaan ${currentQuestionIndex + 1} dari ${questions.length}`;
        }
        
        function showResults() {
            document.getElementById('quiz-screen').classList.add('hidden');
            document.getElementById('result-screen').classList.remove('hidden');

            const sortedScores = Object.entries(scores).sort((a, b) => b[1] - a[1]);
            const dominantType = sortedScores[0][0];
            const secondaryType = sortedScores[1][0];
            
            userProfile.dominant = profiles[dominantType];
            userProfile.secondary = profiles[secondaryType];

            renderReport(dominantType, secondaryType, sortedScores);
            sendDataToGoogleSheet(dominantType, secondaryType);
        }

        function renderReport(dominantType, secondaryType, sortedScores) {
            const dominantProfile = profiles[dominantType];
            const secondaryProfile = profiles[secondaryType];
            
            document.getElementById('dominant-title').innerHTML = `${dominantProfile.title} ${dominantProfile.emoji}`;
            document.getElementById('summary-text').innerHTML = `<p>Laporan ini dirancang khusus untuk Anda yang memiliki potensi dominan <strong>${dominantProfile.title.split(' ')[1]}</strong> dengan dukungan kuat dari potensi sekunder <strong>${secondaryProfile.title.split(' ')[1]}</strong>.</p>`;

            const tabsContainer = document.getElementById('tabs-container');
            const tabContentContainer = document.getElementById('tab-content');
            tabsContainer.innerHTML = '';
            tabContentContainer.innerHTML = '';

            const reportPaths = dominantProfile.report;
            Object.keys(reportPaths).forEach((key, index) => {
                const pathData = reportPaths[key];
                const tabButton = document.createElement('button');
                tabButton.className = `tab-btn ${index === 0 ? 'active' : ''}`;
                tabButton.textContent = pathData.title;
                tabButton.onclick = () => switchTab(key);
                tabsContainer.appendChild(tabButton);

                const tabContent = document.createElement('div');
                tabContent.id = `content-${key}`;
                tabContent.className = `report-section ${index > 0 ? 'hidden' : ''}`;
                tabContent.innerHTML = `
                    <h3>Peran Ideal Anda sebagai ${pathData.title.split(' ')[2] || pathData.title.split(' ')[1]}</h3>
                    <p>${pathData.peran}</p>
                    <h4>✅ Kunci Sukses Anda:</h4>
                    <ul>${pathData.kunci.map(item => `<li>${item}</li>`).join('')}</ul>
                    <h4>⚠️ Tantangan & Cara Mengatasinya:</h4>
                    <ul>${pathData.tantangan.map(item => `<li>${item}</li>`).join('')}</ul>
                `;
                tabContentContainer.appendChild(tabContent);
            });

            renderChart(sortedScores);
        }

        function switchTab(key) {
            document.querySelectorAll('#tabs-container .tab-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            document.querySelectorAll('#tab-content .report-section').forEach(content => content.classList.add('hidden'));
            document.getElementById(`content-${key}`).classList.remove('hidden');
        }

        function renderChart(sortedScores) {
            const ctx = document.getElementById('resultChart').getContext('2d');
            const labels = sortedScores.map(score => profiles[score[0]].title.split(' ')[1]);
            const data = sortedScores.map(score => score[1]);
            const backgroundColors = sortedScores.map(score => profiles[score[0]].color);

            if (myChart) myChart.destroy();

            myChart = new Chart(ctx, {
                type: 'bar',
                data: { labels: labels, datasets: [{ label: 'Skor Potensi', data: data, backgroundColor: backgroundColors }] },
                options: { indexAxis: 'y', scales: { x: { beginAtZero: true } }, plugins: { legend: { display: false } } }
            });
        }
        
        function sendDataToGoogleSheet(dominantType, secondaryType) {
            if (SCRIPT_URL === "MASUKKAN_URL_GOOGLE_APPS_SCRIPT_ANDA_DI_SINI") {
                console.log("Google Apps Script URL not configured. Skipping data submission.");
                return;
            }

            const data = {
                timestamp: new Date().toLocaleString("id-ID", { timeZone: "Asia/Jakarta" }),
                name: userData.name,
                email: userData.email,
                phone: userData.phone,
                dominant: profiles[dominantType].title,
                secondary: profiles[secondaryType].title,
                score_praktis: scores.praktis,
                score_logis: scores.logis,
                score_kreatif: scores.kreatif,
                score_perasa: scores.perasa,
                score_serbabisa: scores.serbabisa
            };

            fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors', 
                cache: 'no-cache',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            })
            .then(() => console.log("Data sent to Google Sheet successfully."))
            .catch(error => console.error('Error sending data to Google Sheet:', error));
        }

        function downloadPDF() {
            const element = document.getElementById('report-content-for-download');
            const hiddenContents = element.querySelectorAll('.hidden');
            hiddenContents.forEach(el => el.classList.remove('hidden'));
            const opt = { margin: [0.5, 0.5, 0.5, 0.5], filename: 'Laporan_Potensi_Diri_Lengkap.pdf', image: { type: 'jpeg', quality: 0.98 }, html2canvas: { scale: 2, useCORS: true }, jsPDF: { unit: 'in', format: 'a4', orientation: 'portrait' } };
            html2pdf().set(opt).from(element).save().then(() => {
                hiddenContents.forEach(el => el.classList.add('hidden'));
                const activeTab = document.querySelector('.tab-btn.active');
                if (activeTab) {
                    const finalKey = Object.keys(profiles.praktis.report).find(k => activeTab.textContent.toLowerCase().includes(k));
                    if(finalKey) document.getElementById(`content-${finalKey}`).classList.remove('hidden');
                }
            });
        }

        async function downloadDOCX() {
            const element = document.getElementById('report-content-for-download');
            const hiddenContents = element.querySelectorAll('.hidden');
            hiddenContents.forEach(el => el.classList.remove('hidden'));
            const fileBuffer = await htmlToDocx.asBlob(element.innerHTML);
            hiddenContents.forEach(el => el.classList.add('hidden'));
            const activeTab = document.querySelector('.tab-btn.active');
            if (activeTab) {
                const finalKey = Object.keys(profiles.praktis.report).find(k => activeTab.textContent.toLowerCase().includes(k));
                if(finalKey) document.getElementById(`content-${finalKey}`).classList.remove('hidden');
            }
            const url = URL.createObjectURL(fileBuffer);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'Laporan_Potensi_Diri_Lengkap.docx';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }

        function restartQuiz() {
            currentQuestionIndex = 0;
            scores = { praktis: 0, logis: 0, kreatif: 0, perasa: 0, serbabisa: 0 };
            answerHistory = [];
            document.getElementById('result-screen').classList.add('hidden');
            document.getElementById('start-screen').classList.remove('hidden');
        }

    </script>
</body>
</html>
